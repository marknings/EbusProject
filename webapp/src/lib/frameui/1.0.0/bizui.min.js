/* <%=grunt.template.tody("yyyy-MM-dd")>  */
angular.module("bizui",["bizui.selectUser","bizui.suggest","bizui.roleAuthor","bizui.bizTable","bizui.biznav","bizui.drag","biz.NumberBox","biz.uploadfile"]),selectUser=angular.module("bizui.selectUser",["szseui"]),selectUser.controller("usersController",["$scope","$modal","$modalInstance","$timeout","data","struct","callback","selectData",function(a,b,c,d,e,f,g,h){function i(a,b){if(l(b)&&!j(a,b).iscontain&&a.push(b),void 0!=b.children&&b.children.length>0)for(var c=0;c<b.children.length;c++)i(a,b.children[c])}function j(b,c){var d={};d.iscontain=!1;for(var e=0;e<b.length;e++)if(b[e][a.struct.name]==c[a.struct.name]&&b[e][a.struct.loginName]==c[a.struct.loginName]){d.iscontain=!0,d.index=e;break}return d}function k(a,b){for(var c in b)if(a[c]!==b[c])return!1;return!0}function l(b){return a.struct.target?k(b,a.struct.target):!0}a.items=e,a.struct=f,a.selectItem={},a.ToSelectArray=[],a.istree=!0,a.isSingle="single"==f.mode;var m=function(b,c,d){a.selectItem=d,a.ToSelectArray.splice(0,a.ToSelectArray.length),i(a.ToSelectArray,d),window.safeApply(a,function(){})};a.setting={view:{showLine:!1,showIcon:!1,selectedMulti:!1,dblClickExpand:!1},data:{key:{name:f.name},simpleData:{enable:!0}},callback:{onClick:m}},function q(){var a="tree_1";if($("#"+a).length>0){var b=$.fn.zTree.getZTreeObj(a);if(b){var c=b.getNodes();b.expandNode(c[0],!0)}else d(function(){q()},100)}else d(function(){q()},100)}(),a.cancel=function(){c.dismiss("cancel")},a.confirm_OnClick=function(){return a.SelectArray&&0==a.SelectArray.length?void b.message({moduleName:"用户选择",title:"用户列表为空，请选择用户！"}):(g(a.SelectArray),void c.close())},a.usersController={users:[]},a.$watch(function(){return a.usersController.users},function(b,c){if(void 0!=b&&b instanceof Array&&b!==c)for(var d=0;d<b.length;d++)a.selectAuto(b[d])},!0),a.selectAuto=function(b){a.isSingle&&(a.SelectArray=[]);var c=j(a.SelectArray,b);c.iscontain||a.SelectArray.push(b)},a.autoCompleteItems=[];for(var n=0;n<e.length;n++)i(a.autoCompleteItems,e[n]);a.remove=function(b){var c=j(a.SelectArray,b);c.iscontain&&a.SelectArray.splice(c.index,1)};var o=new Array;a.SelectArray=h?o.concat(h):[],a.select=function(b){a.isSingle&&(a.SelectArray=[]);var c=j(a.SelectArray,b);c.iscontain?a.SelectArray.splice(c.index,1):a.SelectArray.push(b)},a.isSelectContain=function(b){return j(a.SelectArray,b).iscontain},a.selectAll=function(){if(a.ToSelectArray)for(var b=0;b<a.ToSelectArray.length;b++)a.isSelectContain(a.ToSelectArray[b])||a.SelectArray.unshift(a.ToSelectArray[b])},a.clearAll=function(){a.SelectArray.splice(0,a.SelectArray.length)},a.isNotTarget=function(b){for(p in a.struct.target)if(b[p]!==a.struct.target[p])return!0;return!1},a.hasNotTarget=function(b){if(void 0==b||!(b instanceof Array))return!1;if(b.length>0)for(var c=0;c<b.length;c++)for(p in a.struct.target)if(b[c][p]!==a.struct.target[p])return!0;return!1}}]),selectUser.directive("sUser",["$modal",function(a){return{restrict:"EA",require:"ngModel",scope:{mode:"@",name:"=",loginName:"=",data:"=",target:"="},link:function(b,c,d,e){b.setData=function(a){b.selectData=a},b.$watch(function(){return e.$modelValue},function(a){a&&(b.selectData=a)}),b.$watch(function(){return b.selectData},function(a,b){e.$setViewValue(a)}),c[0].onclick=function(){var e=window.$getSzseUiTemplateUrl$(c,d,"selectuser","selectUser");a.open({templateUrl:e,controller:"usersController",dialogClass:"modal-fix",resolve:{data:function(){return b.data},struct:function(){return{name:b.name,loginName:b.loginName,target:b.target,mode:b.mode}},callback:function(){return b.setData},selectData:function(){return b.selectData}}})}}}}]),suggest=angular.module("bizui.suggest",["szseui"]).filter("groupFilter",function(){return function(a,b){function c(a,b){for(var c in b)if(a[c]!==b[c])return!1;return!0}var d=[];return void 0===a?d:($.map(a,function(a,e){c(a,b)&&d.push(a)}),d)}}).controller("SuggestController",["$scope","$attrs","$parse",function(a,b,c){function d(d,e,g){d&&a.$watch(c(d),function(c){a[e]=c,d==b.data&&f()})}function e(b,d){return angular.isDefined(b)?c(a.matchFn):d}function f(){var b=[];a.istree?(g(a.data,b),a.listdata=b):a.listdata=a.data}function g(a,b){void 0!==a&&(a instanceof Array?$.map(a,function(a,c){g(a,b)}):(b.push(a),null!==a.children&&void 0!==a.children&&a.children.length>0&&g(a.children,b)))}function h(a,b){return void 0==b?!0:"string"!=typeof a?!1:"string"==typeof b?a.toUpperCase().indexOf(b.toUpperCase())>-1:a===b}d(b.istree,"istree"),d(b.group,"group"),d(b.isgroup,"isgroup"),d(b.name,"name"),d(b.loginName,"loginName","login-name"),d(b.mode,"mode"),d(b.data,"data");e(b.matchFn,void 0);a.isShow=function(a){return void 0==a||null==a||""==a?!1:!0},a.filterListData=function(b){return a.matchFn?a.matchFn({q:a.matchText,row:b,id:a.id}):void 0==a.matchText||""==a.matchText?!0:h(b[a.name],a.matchText)||h(b[a.loginName],a.matchText)||h(b[a.name]+"("+b[a.loginName]+")",a.matchText)?!0:!1}}]).directive("suggest",["$parse",function(a){return{restrict:"EA",replace:!0,templateUrl:function(a,b){return window.$getSzseUiTemplateUrl$(a,b,"suggest","suggest")},scope:{data:"=",name:"=",loginName:"=",mode:"=",isobject:"="},require:["suggest","?^ngModel"],controller:"SuggestController",link:function(a,b,c,d){function e(b,c){for(var d=0;d<b.length;d++)if(b[d][a.name]==c[a.name]&&b[d][a.loginName]==c[a.loginName])return!0;return!1}function f(b){void 0==a.selectIndex&&(a.selectIndex=0),a.selectIndex=a.selectIndex+b,a.selectIndex<0&&(a.selectIndex=0)}var g=(d[0],d[1]);g&&(a.selectIndex=0,a.width=a.$parent.width,a.height=300,a.matchText=a.$parent.matchText,a.$parent.$watch(function(){return a.$parent.width},function(b){a.width=a.$parent.width}),a.$parent.$watch(function(){return a.$parent.selectItems},function(a){g.$setViewValue(a)}),a.$parent.$watch(function(){return a.$parent.matchText},function(b){a.matchText=b,a.selectIndex=0}),a.$parent.$watch(function(){return a.$parent.id},function(b){a.id=b}),a.$parent.$watch(function(){return a.$parent.matchFn},function(b){a.matchFn=b}),a.clickItem=function(b){var c=g.$modelValue;c instanceof Array||(c=[]),"multiple"===a.mode?e(c,b)||c.push(b):(c.splice(0,g.$modelValue.length),c.push(b));var d=c.concat([]);g.$setViewValue(d)},a.isSelect=function(b,c){return g.$modelValue&&e(g.$modelValue,b)?1:a.selectIndex==c?(a.toSelectItem=b,2):3},a.mouseinItem=function(b){a.selectIndex=b},a.$on("index_minus",function(b){a.$apply(function(){f(-1)})}),a.$on("index_add",function(b){a.$apply(function(){f(1)})}),a.$on("index_choose",function(b){a.$apply(function(b){a.clickItem(a.toSelectItem)})}))}}}]).directive("suggestPopup",["$compile","$parse","$document","$position","$timeout",function(a,b,c,d,e){return{restrict:"EA",require:"ngModel",priority:1,scope:{data:"=",name:"=",loginName:"=",mode:"=",isclear:"=",isobject:"="},link:function(f,g,h,i){function j(a,b){if(b instanceof Array&&0!=b.length){var c=[];$.map(b,function(b){k(a,b[f.name])&&k(a,b[f.loginName].toString())&&k(a,b[f.name]+"("+b[f.loginName]+")")&&c.push(b)}),i.$setViewValue(c)}}function k(a,b){return void 0==b?!0:"string"!=typeof a?!1:"string"==typeof b?a.toUpperCase().indexOf(b.toUpperCase())>-1:a===b}function l(a){s?s(f,!!a):p.isOpen=!!a}function m(a,c,d){a&&(f.$watch(b(a),function(a){p[c]=a}),w.attr(d||c,c))}function n(a){if(!(a instanceof Array))return"";for(var b="",c=0;c<a.length;c++)b=b+a[c][f.name]+"("+a[c][f.loginName]+")",c!==a.length-1&&(b+=";");return b}function o(){p.position=d.position(g),p.position.top=p.position.top+g.prop("offsetHeight"),e(function(){var a=d.offset(A);p.position.left+a.width>document.documentElement.clientWidth&&(p.position.left=document.documentElement.clientWidth-a.width)}),p.height=400;var a=d.offset(g);p.width=a.width}var p=f.$new();f.$on("$destroy",function(){A.remove(),p.$destroy()}),g[0].onkeydown=function(a){switch(a.keyCode){case 40:p.$broadcast("index_add");break;case 38:p.$broadcast("index_minus");break;case 13:p.$broadcast("index_choose")}};var q=!1;g[0].onfocus=function(){q=!0},g[0].onblur=function(){q=!1,j(g[0].value,i.$modelValue),g[0].value=n(i.$modelValue)},f.$watch(function(){return i.$modelValue},function(a,b){a&&(a instanceof Array?(q||(g[0].value=n(a)),1==f.isclear&&(g[0].value="",g.blur())):(j(a,b),g[0].value=a),p.selectItems=i.$modelValue)});var r,s;h.isOpen&&(r=b(h.isOpen),s=r.assign,f.$watch(r,function(a){p.isOpen=!!value})),p.isOpen=r?r(f):!1;var t=function(a){p.isOpen&&a.target!==g[0]&&p.$apply(function(){l(!1)})},u=function(){p.$apply(function(){i.$modelValue&&i.$modelValue.length>0&&"multiple"!=f.mode||l(!0)})};p.selectItems=[];var v=angular.element("<div suggest-wrap><div suggest></div></div>");v.attr({"ng-model":"selectItems","ng-change":"itemsSelection()"});var w=angular.element(v.children()[0]),x={};h.suggestOptions&&(x=f.$eval(h.suggestOptions),w.attr(angular.extend({},x))),m("name","name"),m("loginName","loginName","login-name"),m("mode","mode"),m("data","data"),f.isobject=!0,m("isobject","isobject"),p.itemsSelection=function(){i.$setViewValue(p.selectItems),g[0].value=n(p.selectItems),l(!1)},g.bind("input change keyup",function(a){q&&p.$apply(function(){p.matchText=g[0].value.replace(n(i.$modelValue),""),""!==p.matchText&&l(!0)})});var y=!1,z=!1;p.$watch("isOpen",function(a){a?(o(),p.matchText=g[0].value.replace(n(i.$modelValue),""),c.bind("click",t),z&&g.unbind("focus",u),y=!0):(y&&c.unbind("click",t),g.bind("focus",u),$elementFocusInitialized=!0),s&&s(originalScope,a)});var A=a(v)(p);g.after(A)}}}]).directive("suggestWrap",function(){return{restrict:"EA",replace:!0,transclude:!0,templateUrl:function(a,b){return window.$getSzseUiTemplateUrl$(a,b,"suggest","suggestpopup")},link:function(a,b,c){b.bind("click",function(a){a.preventDefault(),a.stopPropagation()})}}}).directive("selectPopup",["$compile","$parse","$document","$position","$timeout",function(a,b,c,d,e){return{restrict:"EA",require:"ngModel",priority:1,scope:{data:"=",name:"=",loginName:"=",mode:"=",isclear:"=",isobject:"=",issuggest:"=",selectChange:"&"},link:function(f,g,h,i){function j(a){if(f.isobject&&"multiple"==f.mode){if(a instanceof Array)return!0}else if(f.isobject&&"multiple"!=f.mode){if("object"==typeof a)return!0}else if(f.isobject||"multiple"!=f.mode){if(!f.isobject&&"multiple"!=f.mode)for(var b=0;b<f.data.length;b++)if(f.data[b][f.loginName]===a)return!0}else if(a instanceof Array)return!0;return!1}function k(a,b,c){if(f.isobject&&"multiple"==f.mode)i.$setViewValue(a);else if(f.isobject&&"multiple"!=f.mode){for(var d="",e=0;e<f.data.length;e++)if(f.data[e][f.name]==a[f.name]&&f.data[e][f.loginName]==a[f.loginName]){d=f.data[e];break}i.$setViewValue(d)}else if(f.isobject||"multiple"!=f.mode){if(!f.isobject&&"multiple"!=f.mode){var d="";$.map(f.data,function(b){b[f.loginName]==a&&(d=a)}),i.$setViewValue(d)}}else i.$setViewValue(a)}function l(a,b,c){var d=new Array;if(f.isobject&&"multiple"==f.mode)b instanceof Array||(b=new Array),$.map(b,function(b){o(a,b[f.name])&&o(a,b[f.loginName].toString())&&o(a,b[f.name]+"("+b[f.loginName]+")")&&d.push(b)}),i.$setViewValue(d);else if(f.isobject&&"multiple"!=f.mode){for(var e="",g=0;g<f.data.length;g++)o(a,f.data[g][f.name]+"("+f.data[g][f.loginName]+")")&&(e=f.data[g]);i.$setViewValue(e)}else if(f.isobject||"multiple"!=f.mode){if(!f.isobject&&"multiple"!=f.mode){for(var e="",g=0;g<f.data.length;g++)if(f.data[g][f.name]===a){e=f.data[g][f.loginName];break}i.$setViewValue(e)}}else $.map(f.data,function(b){o(a,b[f.name])&&d.push(b[f.loginName])}),i.$setViewValue(d)}function m(a){var b="";if(f.isobject&&"multiple"==f.mode){if(a instanceof Array)for(var c=0;c<a.length;c++)b=b+a[c][f.name]+"("+a[c][f.loginName]+")",c!==a.length-1&&(b+=";")}else if(f.isobject&&"multiple"!=f.mode)"object"==typeof a&&(b=a[f.name]+"("+a[f.loginName]+")");else if(f.isobject||"multiple"!=f.mode){if(!f.isobject&&"multiple"!=f.mode){for(var d=[],c=0;c<f.data.length;c++)if(a===f.data[c][f.loginName]){d.push(f.data[c]);break}d.length>0&&(b=d[0][f.name])}}else if(a instanceof Array){var d=[];$.map(a,function(a){for(var b=0;b<f.data.length;b++)if(a===f.data[b][f.loginName]){d.push(f.data[b]);break}});for(var c=0;c<d.length;c++)b+=d[c][f.name],c!==d.length-1&&(b+=";")}return b}function n(a){if(f.isobject&&"multiple"==f.mode)return a instanceof Array?a:new Array;if(f.isobject&&"multiple"!=f.mode)return"object"==typeof a?new Array(a):new Array;if(!f.isobject&&"multiple"==f.mode){if(a instanceof Array){var b=new Array;return $.map(a,function(a){for(var c=0;c<f.data.length;c++)if(a===f.data[c][f.loginName]){b.push(f.data[c]);break}}),b}return new Array}if(!f.isobject&&"multiple"!=f.mode){for(var b=new Array,c=0;c<f.data.length;c++)if(a===f.data[c][f.loginName]){b.push(f.data[c]);break}return b}}function o(a,b){return void 0==b?!0:"string"!=typeof a?!1:"string"==typeof b?a.toUpperCase().indexOf(b.toUpperCase())>-1:a===b}function p(a){x?x(f,!!a):u.isOpen=!!a}function q(a,c,d){a&&(f.$watch(b(a),function(a){u[c]=a}),B.attr(d||c,c))}function r(a){if(f.isobject&&"multiple"==f.mode)i.$setViewValue(a);else if(f.isobject&&"multiple"!=f.mode)a.length>0&&i.$setViewValue(a[0]);else if(f.isobject||"multiple"!=f.mode)f.isobject||"multiple"==f.mode||a.length>0&&i.$setViewValue(a[0][f.loginName]);else{var b=[];$.map(a,function(a){b.push(a[f.loginName])}),i.$setViewValue(b)}}function s(a){var b="";if(f.isobject&&"multiple"==f.mode)for(var c=0;c<a.length;c++)b=b+a[c][f.name]+"("+a[c][f.loginName]+")",c!==a.length-1&&(b+=";");else if(f.isobject&&"multiple"!=f.mode)a.length>0&&(b=b+a[0][f.name]+"("+a[0][f.loginName]+")");else if(f.isobject||"multiple"!=f.mode)f.isobject||"multiple"==f.mode||a.length>0&&(b=a[0][f.name]);else for(var c=0;c<a.length;c++)b+=a[c][f.name],c!==a.length-1&&(b+=";");return b}function t(){u.position=d.position(g),u.position.top=u.position.top+g.prop("offsetHeight"),e(function(){var a=d.offset(F);u.position.left+a.width>document.documentElement.clientWidth&&(u.position.left=document.documentElement.clientWidth-a.width)}),u.height=400;var a=d.offset(g);u.width=a.width}var u=f.$new();f.$on("$destroy",function(){F.remove(),u.$destroy()}),g[0].onkeydown=function(a){switch(a.keyCode){case 40:u.$broadcast("index_add");break;case 38:u.$broadcast("index_minus");break;case 13:u.$broadcast("index_choose")}};var v=!1;g[0].onfocus=function(){v=!0,u.matchText="",u.$apply(function(){p(!0)})},g[0].onblur=function(){v=!1,l(g[0].value,i.$modelValue,"onblur"),g[0].value=m(i.$modelValue)},f.$watch(function(){return i.$modelValue},function(a,b){f.data instanceof Array||(f.data=[]),void 0==a||j(a)?(void 0==a||a instanceof Array||(g[0].value=m(a)),1==f.isclear&&(g[0].value="",g.blur())):"string"==typeof a?l(a,b):k(a,b),u.selectItems=n(i.$modelValue)});var w,x;h.isOpen&&(w=b(h.isOpen),x=w.assign,f.$watch(w,function(a){u.isOpen=!!value})),u.isOpen=w?w(f):!1;var y=function(a){u.isOpen&&a.target!==g[0]&&u.$apply(function(){p(!1)})},z=function(){u.$apply(function(){p(!0)})};u.selectItems=[];var A=angular.element("<div suggest-wrap><div suggest></div></div>");A.attr({"ng-model":"selectItems","ng-change":"itemsSelection()"});var B=angular.element(A.children()[0]),C={};h.suggestOptions&&(C=f.$eval(h.suggestOptions),B.attr(angular.extend({},C))),q("name","name"),q("loginName","loginName","login-name"),q("mode","mode"),q("data","data"),q("isobject","isobject"),u.itemsSelection=function(){r(angular.copy(u.selectItems)),g[0].value=s(angular.copy(u.selectItems)),f.selectChange&&f.selectChange({ritem:angular.copy(u.selectItems[0])}),p(!1)},g.bind("input change keyup",function(a){v&&(f.issuggest?u.$apply(function(){u.matchText=g[0].value.replace(m(i.$modelValue),"").replace(";",""),p(!0)}):u.$apply(function(){u.matchText="",p(!0)}))});var D=!1,E=!1;u.$watch("isOpen",function(a){a?(t(),u.matchText=g[0].value.replace(m(i.$modelValue),""),c.bind("click",y),E&&g.unbind("focus",z),D=!0):(D&&c.unbind("click",y),g.bind("focus",z),$elementFocusInitialized=!0),x&&x(originalScope,a)});var F=a(A)(u);g.after(F)}}}]).directive("suggestText",["$compile","$parse","$document","$position","$timeout",function(a,b,c,d,e){return{restrict:"EA",require:"ngModel",priority:1,scope:{id:"@",data:"=",name:"=",loginName:"=",mode:"=",isclear:"=",isobject:"=",matchFn:"&"},link:function(f,g,h,i){function j(a){q?q(f,!!a):n.isOpen=!!a}function k(a,c,d){a&&(f.$watch(b(a),function(a){n[c]=a}),u.attr(d||c,c))}function l(a){if(!(a instanceof Array)&&"string"==typeof a)for(var b=0;b<f.data.length;b++)if(a==f.data[b][f.name])return a;for(var c="",b=0;b<a.length;b++)c+=a[b][f.name],b!==a.length-1&&(c+=";");return c}function m(){n.position=d.position(g),n.position.top=n.position.top+g.prop("offsetHeight"),e(function(){var a=d.offset(y);n.position.left+a.width>document.documentElement.clientWidth&&(n.position.left=document.documentElement.clientWidth-a.width)}),n.height=400;var a=d.offset(g);n.width=a.width}var n=f.$new();f.$on("$destroy",function(){y.remove(),n.$destroy()}),g[0].onkeydown=function(a){switch(a.keyCode){case 40:n.$broadcast("index_add");break;case 38:n.$broadcast("index_minus");break;case 13:n.$broadcast("index_choose")}};var o=!1;g[0].onfocus=function(){o=!0,n.selectItems=[]},g[0].onblur=function(){o=!1},f.$watch(function(){return i.$modelValue},function(a,b){"string"!=typeof a&&i.$setViewValue("")});var p,q;h.isOpen&&(p=b(h.isOpen),q=p.assign,f.$watch(p,function(a){n.isOpen=!!value})),n.isOpen=p?p(f):!1;var r=function(a){n.isOpen&&a.target!==g[0]&&n.$apply(function(){j(!1)})},s=function(){n.$apply(function(){j(!0)})};n.selectItems=[];var t=angular.element("<div suggest-wrap><div suggest></div></div>");t.attr({"ng-model":"selectItems","ng-change":"itemsSelection()"});var u=angular.element(t.children()[0]),v={};h.suggestOptions&&(v=f.$eval(h.suggestOptions),u.attr(angular.extend({},v))),f.$watch(b("id"),function(a){n.id=a}),k("name","name"),k("loginName","loginName","login-name"),k("mode","mode"),k("data","data"),k("isobject","isobject"),k("matchFn","matchFn","match-fn"),n.itemsSelection=function(){g[0].value=l(n.selectItems),i.$setViewValue(g[0].value),j(!1)},g.bind("input change keyup",function(a){o&&n.$apply(function(){n.matchText=g[0].value.replace(l(i.$modelValue),""),j(!0)})});var w=!1,x=!1;n.$watch("isOpen",function(a){a?(m(),n.matchText=g[0].value.replace(l(i.$modelValue),""),c.bind("click",r),x&&g.unbind("focus",s),w=!0):(w&&c.unbind("click",r),g.bind("focus",s),$elementFocusInitialized=!0),q&&q(originalScope,a)});var y=a(t)(n);g.after(y)}}}]),roleAuthor=angular.module("bizui.roleAuthor",["szseui"]).constant("roleAuthorConfig",{}).controller("roleAuthorController",["$scope","$attrs","roleAuthorConfig",function(a,b,c){function d(a,b){var c=!0;for(var d in a)if(a[d]!==b[d]&&"$$hashKey"!=d&&"children"!=d){c=!1;break}return c}a.isSelect=function(b){return d(a.selectRole,b)?!0:!1},a.allSelected=function(b){void 0!=b.children&&0!=b.children.length&&$.map(b.children,function(c,d){c[a.settings.check]=b.allSelected})}}]).directive("roleAuthor",["$parse",function(a){return{restrict:"EA",require:"ngModel",replace:!0,controller:"roleAuthorController",scope:{settings:"=",isdisabled:"="},templateUrl:function(a,b){return window.$getSzseUiTemplateUrl$(a,b,"roleAuthor","roleAuthor")},link:function(b,c,d,e){function f(c,d){c&&b.$watch(a(c),function(a){b[d]=a})}function g(a,b){for(var c=void 0,d=0;d<a.length;d++)if(h(a[d],b)){c=d;break}return c}function h(a,b){var c=!0;for(var d in a)if(a[d]!==b[d]&&"$$hashKey"!=d&&"children"!=d){c=!1;break}return c}b.$watch(function(){return e.$modelValue},function(a,c){if(b.data=a,a instanceof Array)if(b.selectRole){if(a){var d=g(a,b.selectRole);d?b.selectRole=a[d]:b.selectRole=a[0]}}else b.selectRole=a[0]}),f("settings","settings"),f("isdisabled","isdisabled"),b.selectrole=function(a){b.selectRole=a}}}}]),angular.module("bizui.bizTable",[]).directive("bizSimpleTable",["$parse","$compile",function(a,b){return{restrict:"EA",replace:!0,scope:{columnModel:"=",stitle:"=",data:"=",repeatstr:"=",tableCss:"@"},link:function(c,d,e){function f(b,d){b&&c.$watch(a(b),function(a){c[d]=a,"columnModel"==b&&void 0!==a&&(t=h(a),v=j(a)),"stitle"==b&&void 0!==a&&(w=n(a)),"tableCss"==b&&void 0!==a&&(x=g(a)),"repeatstr"==b&&void 0!==a&&(u=i(a)),q()})}function g(a){var b='<div class="table-responsive"><table class="table '+a+'">';return b}function h(a){var b="<thead><tr>";return void 0!==a&&a instanceof Array&&$.map(a,function(c,d){b=b+'<th width="'+k(c,a)+'">'+c.label+"</th>"}),b+="</tr></thead>"}function i(a){var b='<tbody><tr  ng-repeat="dataitem in data ';return void 0!==a&&(b+=a),b+=' track by $index">'}function j(a){var b="";return void 0!==a&&a instanceof Array&&$.map(a,function(a,c){void 0==a.renderer?b=b+"<td "+l(a)+m(a)+" >{{dataitem."+a.field+"}}</td>":b+=a.renderer(a,"dataitem")}),b+="</tr></tbody></table></div>"}function k(a,b){if("*"===a.width){for(var c=0,d=0;d<b.length;d++)"*"!==b[d].width&&(c+=parseFloat(b[d].width));return 100-c+"%"}return a.width}function l(a){var b='class="';return b+="left"==a.align?" text-left ":"right"==a.align?" text-right ":" text-center ",1==a.hastitle&&(b+=" u-ellipsis "),b+='" '}function m(a){var b="";return 1==a.hastitle&&(b=b+' title="{{dataitem.'+a.field+'}}"  '),b}function n(a){var b='<div class="title"><span>'+a+"</span></div>";return b}function o(){var a='<div class="bizTable">';return a}function p(){var a="</div>";return a}function q(){var a=b(r+w+x+t+u+v+s)(c);d.empty(),d.append(a)}var r="",s="",t="",u="",v="",w="",x="stable-primary";r=o(),s=p(),u=i(""),f("columnModel","columnModel"),f("stitle","stitle"),f("tableCss","tableCss"),f("repeatstr","repeatstr"),f("data","data")}}}]),angular.module("bizui.biznav",[]).controller("bizNavSideBarController",["$scope",function(a){a.isSelect=function(b){return a.selectItem===b?1:b[a.isread]?2:0},a.read=function(b){b&&(a.selectItem=b)}}]).directive("bizNavSidebar",["$parse",function(a){return{restrict:"EA",replace:!0,require:"ngModel",controller:"bizNavSideBarController",templateUrl:function(a,b){return window.$getSzseUiTemplateUrl$(a,b,"bizNavSidebar","bizNavSidebar")},scope:{data:"=",name:"=",code:"=",isread:"="},link:function(b,c,d,e){function f(c,d){c&&b.$watch(a(c),function(a){b[d]=a})}e&&(b.$watch(function(){return e.$modelValue},function(a,c){e.$setViewValue(a),b.selectItem=a}),b.$watch(function(){return b.selectItem},function(a,b){a!==b&&e.$setViewValue(a)}),f("data","data"),f("name","name"),f("code","code"),f("isread","isread"))}}}]),angular.module("bizui.drag",["szseui"]).directive("dragAble",["$position","$window","$timeout",function(a,b,c){return{restrict:"EA",require:"ngModel",scope:{zindex:"@",zoom:"@",square:"=",eventDom:"=",readonly:"="},link:function(b,d,e,f){function g(){function e(){d.css({top:a.position(d).top+"px",left:a.position(d).left+"px",position:"absolute",width:a.position(d).width+"px",height:a.position(d).height+"px","z-index":b.zindex})}function h(){function c(c){a.offset(d);if(b.square){var e=k.left+(c.screenX-g)-j.left,l=k.top+(c.screenY-h)-j.top,m=b.square[0]===b.square[2],n=b.square[1]==b.square[3],o=e>=b.square[3]&&e<=b.square[1],p=l>=b.square[0]&&l<=b.square[2];if(m&&o&&!b.readonly){k.left=k.left+(c.screenX-g),d.css({left:k.left+"px",top:i.top+"px",position:"absolute","z-index":b.zindex});var q=0,r=void 0==b.zoom?e:e/b.zoom;b.$apply(function(){f.$setViewValue(new Array(q,r))})}else if(n&&p&&!b.readonly){k.top=k.top+(c.screenY-h),d.css({left:i.left+"px",top:k.top+"px",position:"absolute","z-index":b.zindex});var q=void 0==b.zoom?l:l/b.zoom,r=0;b.$apply(function(){f.$setViewValue(new Array(q,r))})}else if(o&&p&&!b.readonly){k.top=k.top+(c.screenY-h),k.left=k.left+(c.screenX-g),d.css({left:k.left+"px",top:k.top+"px",position:"absolute","z-index":b.zindex});var q=void 0==b.zoom?l:l/b.zoom,r=void 0==b.zoom?e:e/b.zoom;b.$apply(function(){f.$setViewValue(new Array(q,r))})}}else if(!b.readonly){k.top=k.top+(c.screenY-h),k.left=k.left+(c.screenX-g),d.css({left:k.left+"px",top:k.top+"px",position:"absolute","z-index":b.zindex});var q=(k.top-j.top)/zoom,r=(k.left-j.left)/zoom;b.$apply(function(){f.$setViewValue(new Array(q,r))})}g=c.screenX,h=c.screenY}var e=!1,g=0,h=0;k.top=a.position(d).top,k.left=a.position(d).left,d.bind("mousedown",function(a){e=!0,g=a.screenX,h=a.screenY}),angular.element(b.eventDom).bind("mouseup",function(a){e&&(e=!1,c(a))}),angular.element(b.eventDom).bind("mousemove",function(a){e&&c(a)}),angular.element(b.eventDom).bind("mouseleave",function(a){e=!1})}var i=a.position(d);if(0==i.width)return void c(function(){g()},250);var j={},k={},l=!0;b.$watch(function(){return f.$modelValue},function(a,c){void 0!==a&&a instanceof Array?(d.css({top:i.top+a[0],left:i.left+a[1],position:"absolute","z-index":b.zindex}),k.top=i.top+a[0],k.left=i.left+a[1],l&&(j.top=i.top-f.$modelValue[0],j.left=i.left-f.$modelValue[1],l=!1)):(j.top=i.top,j.left=i.left,l=!1)}),e(),h()}g()}}}]).directive("bothDrag",["$window","$position","$filter","$timeout","$modal",function(a,b,c,d,e){return{restrict:"EA",replace:!0,require:"ngModel",templateUrl:function(a,b){return window.$getSzseUiTemplateUrl$(a,b,"bothDrag","bothDrag")},scope:{zoom:"@",readonly:"=",eventDom:"="},link:function(a,f,g,h){function i(){function g(){a.rightperNum-a.leftperNum>=0&&(a.leftStyle={width:a.leftperNum+"%"},a.centerStyle={width:a.rightperNum-a.leftperNum+"%"},a.rightStyle={width:100-a.rightperNum+"%"})}if(h){if(a.width=b.position(f.find("#progress-drag")).width,0==a.width)return void d(function(){i()},250);a.leftsquare=new Array(0,.98*a.width,0,0),a.rightsquare=new Array(0,0,0,.98*-a.width),a.leftStyle={width:"0%"},a.centerStyle={width:"100%"},a.rightStyle={width:"0%"},a.leftperNum=0,a.rightperNum=100,a.$watch(function(){return h.$modelValue},function(b,c){if(b instanceof Array){var d=b[0]/100*a.width,e=(b[1]/100-1)*a.width;a.leftposition=new Array(0,d),a.rightposition=new Array(0,e),a.leftEq=b[2],a.rightEq=b[3]}}),a.$watch(function(){return a.leftEq||a.rightEq},function(b){b?(a.leftsquare=new Array(0,.99*a.width,0,0),a.rightsquare=new Array(0,0,0,.99*-a.width)):(a.leftsquare=new Array(0,.98*a.width,0,0),a.rightsquare=new Array(0,0,0,.98*-a.width))}),a.$watch(function(){return a.leftEq},function(b,c){if(!b&&!a.rightEq){var d=parseInt(void 0==a.leftperNum?h.$modelValue[0]:a.leftperNum),f=parseInt(void 0==a.rightNum?h.$modelValue[1]:a.rightNum);f-d==1&&(e.message({moduleName:"数据范围控件",title:"数据范围不合理，请重新调整！"}),a.leftEq=c)}}),a.$watch(function(){return a.rightEq},function(b,c){if(!b&&!a.leftEq){var d=parseInt(void 0==a.leftperNum?h.$modelValue[0]:a.leftperNum),f=parseInt(void 0==a.rightNum?h.$modelValue[1]:a.rightNum);f-d==1&&(e.message({moduleName:"数据范围控件",title:"数据范围不合理，请重新调整！"}),a.rightEq=c)}}),a.leftblur=function(){0==a.leftperNum||a.leftperNum||(a.leftperNum=0),console.log(a.leftperNum),a.leftperNum>=a.rightperNum-2&&(h.$modelValue[2]||h.$modelValue[3]?a.leftperNum=a.rightperNum-1:a.leftperNum=a.rightperNum-2);var b=angular.copy(h.$modelValue);b[0]=a.leftperNum,h.$setViewValue(b)},a.rightblur=function(){console.log(a.rightperNum),0==a.rightperNum||a.rightperNum||(a.rightperNum=0),a.rightperNum<=a.leftperNum+2&&(h.$modelValue[2]||h.$modelValue[3]?a.rightperNum=a.leftperNum+1:a.rightperNum=a.leftperNum+2);var b=angular.copy(h.$modelValue);b[1]=a.rightperNum,h.$setViewValue(b)},a.$watch(function(){return a.leftposition},function(b){if(void 0==b)a.leftper="0%";else{a.leftper=c("number")(a.leftposition[1]/a.width*100,0)+"%",a.leftperNum=c("number")(a.leftposition[1]/a.width*100,0);var d,e=parseInt(void 0==a.leftperNum?h.$modelValue[0]:a.leftperNum),f=parseInt(void 0==a.rightNum?h.$modelValue[1]:a.rightNum);if(d=h.$modelValue[2]||h.$modelValue[3]?e+1:e+2,d>f){var i=(d/100-1)*a.width;a.rightposition=new Array(0,i)}else g();var j=h.$modelValue;j[0]=a.leftperNum,h.$setViewValue(j)}}),a.$watch(function(){return a.rightposition},function(b){if(void 0==b)a.rightper="100%";else{a.rightper=c("number")(100*(1- -a.rightposition[1]/a.width),0)+"%",a.rightperNum=c("number")(100*(1- -a.rightposition[1]/a.width),0);var d,e=parseInt(void 0==a.leftperNum?h.$modelValue[0]:a.leftperNum),f=parseInt(void 0==a.rightNum?h.$modelValue[1]:a.rightNum);if(d=h.$modelValue[2]||h.$modelValue[3]?f-1:f-2,e>d){var i=d/100*a.width;a.leftposition=new Array(0,i)}else g();var j=h.$modelValue;j[1]=a.rightperNum,h.$setViewValue(j)}}),a.$watch(function(){return a.leftEq},function(a){var b=h.$modelValue;b[2]=a,h.$setViewValue(b)}),a.$watch(function(){return a.rightEq},function(a){var b=h.$modelValue;b[3]=a,h.$setViewValue(b)})}}i()}}}]),angular.module("biz.NumberBox",[]).directive("numberBox",["$compile","$filter",function(a,b){return{restrict:"EA",scope:{id:"@",prefix:"=",suffix:"=",value:"=",min:"=",max:"=",precision:"=",noformat:"=",onChange:"&"},require:"ngModel",link:function(a,c,d,e){function f(b){b=parseFloat(b);var c=b.toString().length-b.toString().split(".")[0].length,d=0;return d=void 0==a.precision?0:a.precision>c?c:a.precision,a.max&&b>a.max?parseFloat(a.max.toFixed(d)):a.min&&b<a.min?parseFloat(a.min.toFixed(d)):parseFloat(b.toFixed(d))}function g(c){return a.noformat?(a.prefix||"")+parseFloat(f(h(parseFloat(c))))+(a.suffix||""):(a.prefix||"")+b("number")(parseFloat(f(h(parseFloat(c)))))+(a.suffix||"")}function h(b){return"%"===a.suffix?100*b:"万"===a.suffix?b/1e4:b}function i(){return parseFloat(c[0].value)||0===parseFloat(c[0].value)?!0:""==c[0].value?"empty":!1}if(e){var j=!1;a.$watch(function(){return e.$modelValue},function(a){return"number"==typeof a?void(c[0].value=g(e.$modelValue)):(c[0].value=g(e.$modelValue),void e.$setViewValue(f(e.$modelValue).toString()))}),e.$parsers.push(function(a){return f("string"==typeof a?parseFloat(a.replace(/,/g,"")):parseFloat(a))}),$(function(){c[0].onkeydown=function(a){if(8==a.keyCode||9==a.keyCode||190==a.keyCode||110==a.keyCode||46==a.keyCode)return!0;if(a.keyCode<=105&&a.keyCode>=96)return!0;var b=String.fromCharCode(a.keyCode);return/\d/.test(b)},c[0].onfocus=function(){j=!0},c[0].onblur=function(){j=!1,a.$apply(function(){var a=i();if("empty"===a)e.$setViewValue(void 0);else if(a){var b=c[0].value;"string"==typeof c[0].value&&(b=c[0].value.replace(/,/g,"")),e.$setViewValue(b),c[0].value=g(b)}})}})}}}}]),angular.module("biz.uploadfile",["szseui"]).controller("uploadfileController",["$scope","$modal",function(a,b){}]).directive("uploadFile",["$modal",function(a){return{restrict:"AE",require:"ngModel",controller:"uploadfileController",scope:{isreadonly:"=",phyPath:"="},templateUrl:function(a,b){return window.$getSzseUiTemplateUrl$(a,b,"uploadfile","uploadfile")},link:function(b,c,d,e){function f(a){var b=[];if(void 0==a)return b;for(var c=0;c<a.length;c++){var d={};d.fileId=a[c].fileId,d.fileName=a[c].fileName,b.unshift(d)}return b}function g(a){var b=[];if(a&&a.length>0)for(var c=0;c<a.length;c++){var d={};d.progress={},d.progress.percent=100,d.fileId=a[c].fileId,d.fileName=a[c].fileName,d.filesArrIndex=c,b.unshift(d)}return b}b.filesArr=[];var h=[];b.$watch(function(){return e.$modelValue},function(a,c){a instanceof Array?(b.filesArr=g(a),h=angular.copy(b.filesArr)):b.filesArr=[]}),b.removeFile=function(c,d){a.confirmation({title:"文件删除",moduleName:"警告",message:"确定删除“"+d.fileName+"”吗？",ok:function(){b.filesArr.splice(c,1),h.splice(c,1),e.$setViewValue(f(h))}})},b.preUpload=function(a){},b.uploadComplete=function(a){var c=!0;a.loadSucess=!0,a.progress.totalSize/1048576<1?a.tsize=parseInt(a.progress.totalSize/1024)+"kb":a.tsize=Math.round(a.progress.totalSize/1048576)+"M";for(var d=0;d<h.length;d++)if(a.filesArrIndex==h[d].filesArrIndex){c=!1,h[d]=a,e.$setViewValue(f(h));break}c&&(h.unshift(a),e.$setViewValue(f(h))),b.$apply()},b.uploadFail=function(a){if(a.stateClass=!0,a.index>=0)for(var c=0;c<h.length;c++)if(a.filesArrIndex==h[c].filesArrIndex){h.splice(c,1),e.$setViewValue(f(h));break}b.$apply()},b.enterQueue=function(a){a.index?(a.filesArrIndex=b.filesArr[a.index].filesArrIndex,b.filesArr[a.index]=a):(a.progress={},a.progress.percent=0,b.filesArr.unshift(a),a.filesArrIndex=b.filesArr.length-1),b.$apply()},b.uploading=function(a){b.$apply()}}}}]).directive("downLoad",["$modal",function(a){
return{restrict:"AE",scope:{fileId:"="},link:function(b,c,d){$(c).click(function(){$.ajax({type:"get",cache:!1,url:window.$ctx+"/download/file",data:{id:b.fileId},error:function(b,c,d){a.message({type:"warning",title:"警告",message:"下载失败"})},success:function(b){return 1==!b.sucess?void a.message({type:"warning",title:"警告",message:"下载失败"}):void(location.href=b.result)}})})}}}]).directive("ajaxUpload",["$modal",function(a){return{restrict:"AE",scope:{allowedExts:"=",catalogId:"=",progressInterval:"=",allowMultiAsync:"=",getTokenUrl:"=",maxUploadSize:"=",phyPath:"=",needCertification:"=",needCallback:"=",preUpload:"&",uploadComplete:"&",uploadFail:"&"},templateUrl:window.$getSzseUiTemplateUrl$($element,$attr,"uploadfile","upload"),link:function(b,c,d){var e=b.getTokenUrl?b.getTokenUrl:window.$ctx+"file/getUploadUrl";b.successFile=[];var f=(new Date).getTime(),g=$("body").children("#uploadInputsContainer");g.length<1&&(g=$("<div class='uploadInputsContainer' id='uploadInputsContainer'>").appendTo("body"));var h=c.children(".uploadFile");h.attr("id","uploadFile"+f),b.fileDelete=function(a){b.successFile.splice(a,1)};var i=new Ajax_upload(h.attr("id"),{allowedExts:b.allowedExts,catalogId:b.catalogId,progressInterval:b.progressInterval,allowMultiAsync:b.allowMultiAsync,getTokenUrl:e,maxUploadSize:b.maxUploadSize,phyPath:b.phyPath,needCertification:b.needCertification,needCallback:b.needCallback,inputsContainer:"uploadInputsContainer"});i.stage1formater=function(a){return a.result=!0,a},i.stage2formater=function(a){var b=a.length,c=0;if(b)for(;b>c;c++)"100"==a[c].percent&&(a[c].uploadStatus="3");else"100"==a.percent&&(a.uploadStatus="3");return a},i.setUploadValidate(function(a){return!0}),i.on("validateFail",function(a,b){}),i.on("beforeEnterQueue",function(a,b){}),i.on("sign",function(a,b){}),i.on("certifiedFail",function(a,b){});var j;i.on("enterQueue",function(b,c){j=a.open({templateUrl:window.$getSzseUiTemplateUrl$($element,$attr,"uploadfile","progress"),controller:"progressCtrl",resolve:{items:function(){return b}}})}),i.on("preUpload",function(a,c){b.preUpload({file:a})}),i.on("preUploadFail",function(b,c){j.close(),a.message({type:"warning",title:"获取token失败",message:c})}),i.on("uploading",function(a,c){b.$apply()}),i.on("uploadComplete",function(a,c){setTimeout(function(){b.allowMultiAsync?b.successFile.push(a):b.successFile=a,j.close(),b.$apply(),b.uploadComplete({file:a})},700)}),i.on("uploadFail",function(c,d){j.close(),a.message({type:"warning",title:"上传文件失败",message:d}),b.uploadFail({file:c})})}}}]).directive("typeAjaxUpload",["$modal",function(a){return{restrict:"AE",scope:{fileIndex:"@",btnId:"@",allowedExts:"=",catalogId:"=",progressInterval:"=",allowMultiAsync:"=",getTokenUrl:"=",maxUploadSize:"=",phyPath:"=",maxSize:"=",needCertification:"=",needCallback:"=",enterQueue:"&",preUpload:"&",uploading:"&",uploadComplete:"&",uploadFail:"&"},link:function(b,c,d){var e=b.maxSize?b.maxSize:20971520,f="uploadInputsContainer"+(new Date).getTime();$(c).wrap("<div style='display:inline-block; position: relative;' id='"+f+"'>");var g="txt,doc,docx,ppt,pptx,pdf,xls,xlsx,xml,zip,rar,bmp,jpg,gif,rd,png";g=b.allowedExts&&""!=$.trim(b.allowedExts)?b.allowedExts:g;var h=b.getTokenUrl?b.getTokenUrl:window.$ctx+"/file/getUploadUrl";b.successFile=[],c.attr("id",b.btnId);var i=new Ajax_upload(b.btnId,{allowedExts:g,catalogId:b.catalogId,progressInterval:b.progressInterval,allowMultiAsync:b.allowMultiAsync,getTokenUrl:h,isSingleFile:!1,maxUploadSize:b.maxUploadSize,phyPath:b.phyPath,needCertification:b.needCertification,needCallback:b.needCallback,validateFail:function(c,d){a.message({type:"warning",title:"验证失败",message:d}),b.uploadFail({file:c,msg:d,failMsg:"验证失败"})},inputsContainer:f});$(c).parent().hover(function(){$(c).addClass("hover")},function(){$(c).removeClass("hover")}),i.stage1formater=function(a){return a.result=!0,a},i.stage2formater=function(a){var b=a.length,c=0;if(b)for(;b>c;c++)"100"==a[c].percent&&(a[c].uploadStatus="3");else"100"==a.percent&&(a.uploadStatus="3");return a},i.setUploadValidate(function(a){return!0}),i.on("beforeEnterQueue",function(a,b){}),i.on("sign",function(a,b){}),i.on("certifiedFail",function(c,d){a.message({type:"warning",title:"数字验证失败",message:d}),b.uploadFail({file:c,msg:d,failMsg:"数字验证失败"})}),i.on("enterQueue",function(c,d){c.file.size>e?(i.cancelUpload(),a.message({type:"warning",title:"上传文件太大",message:"请上传小于20兆的文件"})):(c.index=b.fileIndex,b.enterQueue({file:c}))}),i.on("preUpload",function(a,c){b.preUpload({file:a})}),i.on("preUploadFail",function(a,c){b.uploadFail({file:a,msg:c,failMsg:"获取token失败"})}),i.on("uploading",function(a,c){b.uploading({file:a})}),i.on("uploadComplete",function(a,c){b.uploadComplete({file:a})}),i.on("uploadFail",function(a,c){b.uploadFail({file:a,msg:c,failMsg:"上传文件失败"})}),b.$on("stop-progress",function(a,b){i.stopProgress()})}}}]).controller("progressCtrl",["$scope","items",function(a,b){a.progress=[b],a.items=b}]);